<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>nginx | 嘻哈工程师</title>
    <meta name="description" content="嘻哈工程师的博客">
    <meta name="generator" content="VuePress 1.4.0">
    <script type="text/javascript" src="/baidu-analytics.js" async="async"></script>
  <link rel="icon" href="/icons/favicon.ico">
  <meta name="referrer" content="no-referrer">
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#3eaf7c">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <link rel="apple-touch-icon" sizes="192x192" href="/icons/192.png">
  <meta name="msapplication-TileImage" content="/icons/144.png">
  <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/assets/css/0.styles.cb726fc1.css" as="style"><link rel="preload" href="/assets/js/app.9c824518.js" as="script"><link rel="preload" href="/assets/js/2.8423ab85.js" as="script"><link rel="preload" href="/assets/js/52.95df1785.js" as="script"><link rel="preload" href="/assets/js/5.d4f27e5e.js" as="script"><link rel="prefetch" href="/assets/js/10.5bd061ef.js"><link rel="prefetch" href="/assets/js/11.9ad975e9.js"><link rel="prefetch" href="/assets/js/12.622d7aaf.js"><link rel="prefetch" href="/assets/js/13.c9c47660.js"><link rel="prefetch" href="/assets/js/14.875bf88d.js"><link rel="prefetch" href="/assets/js/15.bdb5a61d.js"><link rel="prefetch" href="/assets/js/16.606b49b5.js"><link rel="prefetch" href="/assets/js/17.3e88af87.js"><link rel="prefetch" href="/assets/js/18.8eeb5352.js"><link rel="prefetch" href="/assets/js/19.d5cab7cb.js"><link rel="prefetch" href="/assets/js/20.103faf18.js"><link rel="prefetch" href="/assets/js/21.77e688fd.js"><link rel="prefetch" href="/assets/js/22.2b982f6f.js"><link rel="prefetch" href="/assets/js/23.e9138a0c.js"><link rel="prefetch" href="/assets/js/24.807bc40c.js"><link rel="prefetch" href="/assets/js/25.20a49966.js"><link rel="prefetch" href="/assets/js/26.e2d3d5cf.js"><link rel="prefetch" href="/assets/js/27.99908274.js"><link rel="prefetch" href="/assets/js/28.391a110f.js"><link rel="prefetch" href="/assets/js/29.9ea02ed7.js"><link rel="prefetch" href="/assets/js/3.fea1cb5c.js"><link rel="prefetch" href="/assets/js/30.9ad432b0.js"><link rel="prefetch" href="/assets/js/31.766ea3ee.js"><link rel="prefetch" href="/assets/js/32.46a59fd7.js"><link rel="prefetch" href="/assets/js/33.933174ce.js"><link rel="prefetch" href="/assets/js/34.e91cd7f0.js"><link rel="prefetch" href="/assets/js/35.517ec90d.js"><link rel="prefetch" href="/assets/js/36.f0d02ff1.js"><link rel="prefetch" href="/assets/js/37.d1766a62.js"><link rel="prefetch" href="/assets/js/38.5a49fe82.js"><link rel="prefetch" href="/assets/js/39.572b09e2.js"><link rel="prefetch" href="/assets/js/4.a24a1734.js"><link rel="prefetch" href="/assets/js/40.9d597bbe.js"><link rel="prefetch" href="/assets/js/41.05c314a6.js"><link rel="prefetch" href="/assets/js/42.ae6fbee5.js"><link rel="prefetch" href="/assets/js/43.ffd17cd8.js"><link rel="prefetch" href="/assets/js/44.bbf9c3c1.js"><link rel="prefetch" href="/assets/js/45.fbfe96fd.js"><link rel="prefetch" href="/assets/js/46.0e98ea6e.js"><link rel="prefetch" href="/assets/js/47.5bd9e104.js"><link rel="prefetch" href="/assets/js/48.7bba53fe.js"><link rel="prefetch" href="/assets/js/49.f78853ad.js"><link rel="prefetch" href="/assets/js/50.d7c93fab.js"><link rel="prefetch" href="/assets/js/51.2706267b.js"><link rel="prefetch" href="/assets/js/53.d46602d7.js"><link rel="prefetch" href="/assets/js/54.66b5e944.js"><link rel="prefetch" href="/assets/js/55.108cd09b.js"><link rel="prefetch" href="/assets/js/56.d05fe6d8.js"><link rel="prefetch" href="/assets/js/57.5f19a126.js"><link rel="prefetch" href="/assets/js/58.06bbd58f.js"><link rel="prefetch" href="/assets/js/59.3f190a7e.js"><link rel="prefetch" href="/assets/js/6.e021ca0d.js"><link rel="prefetch" href="/assets/js/60.f6205250.js"><link rel="prefetch" href="/assets/js/61.db8e923c.js"><link rel="prefetch" href="/assets/js/62.3067ccda.js"><link rel="prefetch" href="/assets/js/63.d4bbb875.js"><link rel="prefetch" href="/assets/js/64.05be7c5a.js"><link rel="prefetch" href="/assets/js/65.b865ed3f.js"><link rel="prefetch" href="/assets/js/66.e27b357b.js"><link rel="prefetch" href="/assets/js/67.66798db1.js"><link rel="prefetch" href="/assets/js/68.7b4ef1cb.js"><link rel="prefetch" href="/assets/js/7.ed32b398.js"><link rel="prefetch" href="/assets/js/8.63fa3eff.js"><link rel="prefetch" href="/assets/js/9.cfaf880c.js">
    <link rel="stylesheet" href="/assets/css/0.styles.cb726fc1.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">嘻哈工程师</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/guide/" class="nav-link">
  最新
</a></div><div class="nav-item"><a href="/archives/" class="nav-link">
  归档
</a></div> <a href="https://github.com/shimingw/vpblog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/guide/" class="nav-link">
  最新
</a></div><div class="nav-item"><a href="/archives/" class="nav-link">
  归档
</a></div> <a href="https://github.com/shimingw/vpblog" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/docs/2020-02-07-服务器搭建-SSL的申请与部署/" class="sidebar-link">SSL的申请与部署</a></li><li><a href="/docs/2019-07-01-服务器搭建-nginx/" class="active sidebar-link">nginx</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/2019-07-01-服务器搭建-nginx/#http-协议" class="sidebar-link">http 协议</a></li><li class="sidebar-sub-header"><a href="/docs/2019-07-01-服务器搭建-nginx/#常用变量" class="sidebar-link">常用变量</a></li><li class="sidebar-sub-header"><a href="/docs/2019-07-01-服务器搭建-nginx/#常用指令" class="sidebar-link">常用指令</a></li><li class="sidebar-sub-header"><a href="/docs/2019-07-01-服务器搭建-nginx/#配置gzip" class="sidebar-link">配置gzip</a></li><li class="sidebar-sub-header"><a href="/docs/2019-07-01-服务器搭建-nginx/#负载均衡" class="sidebar-link">负载均衡</a></li><li class="sidebar-sub-header"><a href="/docs/2019-07-01-服务器搭建-nginx/#健康检查" class="sidebar-link">健康检查**</a></li><li class="sidebar-sub-header"><a href="/docs/2019-07-01-服务器搭建-nginx/#反向代理" class="sidebar-link">反向代理</a></li><li class="sidebar-sub-header"><a href="/docs/2019-07-01-服务器搭建-nginx/#https-配置" class="sidebar-link">Https 配置</a></li><li class="sidebar-sub-header"><a href="/docs/2019-07-01-服务器搭建-nginx/#适配pc与移动环境" class="sidebar-link">适配PC与移动环境</a></li></ul></li><li><a href="/docs/2018-03-25-服务器搭建-Linux/" class="sidebar-link">Linux</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="http-协议"><a href="#http-协议" class="header-anchor">#</a> http 协议</h2> <p><strong>请求头</strong></p> <p><code>Connection</code>：close 和 keep-alive。是否支持长连接。长连接可以重用 http 请求资源，减少资源开销
<code>Host</code>：发起请求的域名或者 ip
<code>etag</code>：被请求变量的实体值，nginx 会给每个静态资源打上一个 etag 标签，客户端每次请求的时候会带上<code>If-None-Match</code>如果 nginx 的资源没有发生变化，则 Etag 标签不会发生改变。浏览器会返回 304，服务器就从缓存中读取资源。</p> <h2 id="常用变量"><a href="#常用变量" class="header-anchor">#</a> 常用变量</h2> <ul><li><code>$http_host</code>：客户端请求头中携带的 host</li> <li><code>$host</code>：nginx 服务器的域名或者 ip</li> <li><code>$proxy_port</code>：<strong>proxy_pass</strong>对应后端服务器的端口</li> <li><code>$remote_addr</code>：用户 ip</li> <li><code>$proxy_add_x_forwarded_for</code>：添加用户 ip 和每次 nginx 反向代理服务器的 ip 用逗号隔开，起到一个溯源的作用。</li></ul> <h2 id="常用指令"><a href="#常用指令" class="header-anchor">#</a> 常用指令</h2> <p><strong>proxy_set_header</strong></p> <blockquote><p>允许重新定义或者添加发往后端服务器的请求头</p></blockquote> <p>Host</p> <p>默认情况下，只有两个请求头会被重新定义：<code>Host</code>和<code>Connection</code></p> <p>如果不想改变请求头“Host”的值，可以这样来设置：
<code>proxy_set_header Host $http_host;</code></p> <p><strong>websocket</strong></p> <p>nginx 代理转发 websocket 请求</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token keyword">proxy_set_header</span> Upgrade <span class="token variable">$http_upgrade</span><span class="token punctuation">;</span>
<span class="token keyword">proxy_set_header</span> Connection <span class="token string">&quot;upgrade&quot;</span><span class="token punctuation">;</span>
</code></pre></div><p>长链接如果长时间没有响应会被<code>nginx</code>中断
解决方案1
修改<code>timeout</code>时间</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token keyword">proxy_connect_timeout</span><span class="token punctuation">;</span> 
<span class="token keyword">proxy_read_timeout</span><span class="token punctuation">;</span> 
<span class="token keyword">proxy_send_timeout</span><span class="token punctuation">;</span>
</code></pre></div><p>解决方案2
定时发送心跳包</p> <p><strong>proxy_connect_timeout</strong></p> <blockquote><p>设置与后端服务器建立连接的超时时间。应该注意这个超时一般不可能大于 75 秒。默认 60s</p></blockquote> <p><strong>proxy_read_timeout</strong></p> <blockquote><p>定义从后端服务器读取响应的超时。此超时是指相邻两次读操作之间的最长时间间隔，而不是整个响应传输完成的最长时间。如果后端服务器在超时时间段内没有传输任何数据，连接将被关闭。</p></blockquote> <p><strong>proxy_send_timeout</strong></p> <blockquote><p>定义向后端服务器传输请求的超时。此超时是指相邻两次写操作之间的最长时间间隔，而不是整个请求传输完成的最长时间。如果后端服务器在超时时间段内没有接收到任何数据，连接将被关闭。</p></blockquote> <p><strong>proxy_pass</strong></p> <blockquote><p>设置后端服务器的协议和地址</p></blockquote> <h2 id="配置gzip"><a href="#配置gzip" class="header-anchor">#</a> 配置gzip</h2> <blockquote><p>开启Nginx gzip，压缩后,静态资源的大小会大大的减少,从而可以节约大量的带宽,提高传输效率.</p></blockquote> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token keyword">server</span><span class="token punctuation">{</span>
    <span class="token keyword">gzip</span> on<span class="token punctuation">;</span> <span class="token comment">#启动</span>
    <span class="token comment">#gzip_buffer number size 指定申请缓存空间的个数和每个空间的大小,size为内存页一页的大小getconf PAGE_SIZE</span>
    <span class="token keyword">gzip_buffers</span> <span class="token number">4</span> <span class="token number">8</span>K<span class="token punctuation">;</span>
    <span class="token keyword">gzip_comp_level</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">#压缩级别，1-10，数字越大压缩的越小，但是消耗cpu</span>
    <span class="token keyword">gzip_min_length</span> <span class="token number">1</span>k<span class="token punctuation">;</span> <span class="token comment">#不压缩临界值，一般为1kb以上</span>
    <span class="token keyword">gzip_types</span> application<span class="token operator">/</span>javascript text<span class="token operator">/</span>css text<span class="token operator">/</span>xml<span class="token punctuation">;</span>    <span class="token comment">#匹配压缩类型</span>
    <span class="token keyword">gzip_disable</span> <span class="token string">&quot;MSIE [1-6]\.&quot;</span><span class="token punctuation">;</span> <span class="token comment"># IE6对Gzip不友好，指定哪些浏览器不需要压缩</span>
    <span class="token keyword">gzip_vary</span> on<span class="token punctuation">;</span> <span class="token comment">#启用应答头&quot;Vary: Accept-Encoding&quot;，告诉数据接收方数据进行了压缩</span>
<span class="token punctuation">}</span>
</code></pre></div><p>对比一下压缩前后整个的<strong>load</strong>时间，缩短了<strong>83%</strong></p> <p>压缩前</p> <p><img src="https://wx3.sinaimg.cn/mw690/a0940ce6gy1gde92tlh4ej20qk0hh0v5.jpg" alt="压缩前"></p> <p>压缩后</p> <p><img src="https://wx4.sinaimg.cn/mw690/a0940ce6gy1gde92o96tfj20sb0hpmzn.jpg" alt="压缩后"></p> <h2 id="负载均衡"><a href="#负载均衡" class="header-anchor">#</a> 负载均衡</h2> <p><strong>轮询（默认）</strong></p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token keyword">upstream</span> backserver <span class="token punctuation">{</span>
    <span class="token keyword">server</span> <span class="token number">192.168</span><span class="token number">.0</span><span class="token number">.1</span><span class="token punctuation">;</span>
    <span class="token keyword">server</span> <span class="token number">192.168</span><span class="token number">.0</span><span class="token number">.2</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>权重weight</strong></p> <p>指定不同ip的权重，权重与访问比成正相关，权重越高，访问越大，适用于不同性能的机器。</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token keyword">upstream</span> backserver <span class="token punctuation">{</span>
    <span class="token keyword">server</span> <span class="token number">192.168</span><span class="token number">.0</span><span class="token number">.1</span> weight<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token keyword">server</span> <span class="token number">192.168</span><span class="token number">.0</span><span class="token number">.2</span> weight<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>响应时间来分配</strong></p> <p>公平竞争，谁相应快，谁处理，不过这种方式需要依赖到第三方插件<code>nginx-upstream-fair</code>，需要先安装。</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token keyword">upstream</span> backserver <span class="token punctuation">{</span>
    <span class="token keyword">server</span> <span class="token number">192.168</span><span class="token number">.0</span><span class="token number">.1</span><span class="token punctuation">;</span>
    <span class="token keyword">server</span> <span class="token number">192.168</span><span class="token number">.0</span><span class="token number">.2</span><span class="token punctuation">;</span>
    fair<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="健康检查"><a href="#健康检查" class="header-anchor">#</a> 健康检查**</h2> <p><strong>Nginx</strong>自带<code>ngx_http_upstream_module</code> （健康检测模块）本质上服务器心跳的检查，通过定期轮询向集群里的服务器发送健康检查请求,来检查集群中是否有服务器处于异常状态。</p> <p>如果检测出其中某台服务器异常,那么在通过客户端请求nginx反向代理进来的都不会被发送到该服务器上（直至下次轮训健康检查正常）</p> <p><strong>判断异常依据<code>proxy_next_upstream</code>的配置</strong></p> <div class="language- extra-class"><pre class="language-text"><code>Syntax: proxy_next_upstream error | timeout | invalid_header | http_500 | http_502 | http_503 | http_504 | http_403 | http_404 | non_idempotent | off ...;
Default:    proxy_next_upstream error timeout;
Context:    http, server, location
</code></pre></div><ul><li>error:在与服务器建立连接，向其传递请求或读取响应标头时发生错误;</li> <li>timeout:在与服务器建立连接，向其传递请求或读取响应头时发生超时;</li> <li>invalid_header:服务器返回空响应或无效响应;</li> <li>http_500:服务器返回了带有代码500的响应;</li> <li>http_502:服务器返回具有代码502的响应;</li> <li>HTTP_503:服务器返回具有代码503的响应;</li> <li>http_504:服务器返回具有代码504的响应;</li> <li>http_403:服务器返回带有代码403的响应;</li> <li>http_404:服务器返回具有代码404的响应;</li> <li>non_idempotent:通常，如果请求已经被发送到上游服务器（1.9.13），则具有非幂等方法的请求（POST，LOCK，PATCH）不被传递到下一个服务器;启用此选项明确允许重试此类请求;</li> <li>off:禁用将请求传递到下一个服务器。</li></ul> <p><strong>配置参数</strong></p> <ul><li>max_fails：设定Nginx与服务器通信的尝试失败的次数，默认为：1次</li> <li>fail_timeout：设定服务器被认为不可用的时间段以及统计失败尝试次数的时间段，默认为10s</li></ul> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token keyword">upstream</span> backserver<span class="token punctuation">{</span>
    <span class="token keyword">server</span> <span class="token number">192.168</span><span class="token number">.0</span><span class="token number">.1</span>  max_fails<span class="token operator">=</span><span class="token number">1</span> fail_timeout<span class="token operator">=</span><span class="token number">40</span>s<span class="token punctuation">;</span>
    <span class="token keyword">server</span> <span class="token number">192.168</span><span class="token number">.0</span><span class="token number">.2</span>  max_fails<span class="token operator">=</span><span class="token number">1</span> fail_timeout<span class="token operator">=</span><span class="token number">40</span>s<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="反向代理"><a href="#反向代理" class="header-anchor">#</a> 反向代理</h2> <p>将一个请求转发到另一个资源（可以是另一台服务器，也可以使本服务器的指定目录）</p> <p><strong>作用</strong></p> <ul><li>防火墙作用：不想暴露真正的服务器，可以是用<code>nginx</code>作为中间层，同时也能过滤到一些非法请求</li> <li>负载均衡</li></ul> <p>主要使用<code>proxy_pass</code>指令来实现反向代理</p> <h2 id="https-配置"><a href="#https-配置" class="header-anchor">#</a> Https 配置</h2> <p>参考这里<a href="https://shimingw.cn/docs/2020-02-07-%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%90%AD%E5%BB%BA-SSL%E7%9A%84%E7%94%B3%E8%AF%B7%E4%B8%8E%E9%83%A8%E7%BD%B2/#ssl%E8%AF%81%E4%B9%A6%E7%94%B3%E8%AF%B7%E6%AD%A5%E9%AA%A4" target="_blank" rel="noopener noreferrer">SSL的申请与部署<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="适配pc与移动环境"><a href="#适配pc与移动环境" class="header-anchor">#</a> 适配PC与移动环境</h2> <p>当用户从移动端打开PC端baidu.com的场景时，将自动跳转指移动端m.baidu.com，本质上是Nginx可以通过内置变量$http_user_agent，获取到请求客户端的userAgent。</p> <p>从而知道当前用户当前终端是移动端还是PC，进而重定向到H5站还是PC站。</p> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token keyword">server</span> <span class="token punctuation">{</span>
 <span class="token keyword">location</span> <span class="token operator">/</span> <span class="token punctuation">{</span>
        <span class="token comment"># 移动、pc设备agent获取</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$http_user_agent</span> <span class="token operator">~</span><span class="token operator">*</span> <span class="token string">'(Android|webOS|iPhone)'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">set</span> <span class="token variable">$mobile_request</span> <span class="token string">'1'</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$mobile_request</span> <span class="token operator">=</span> <span class="token string">'1'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">rewrite</span> <span class="token operator">^</span><span class="token punctuation">.</span><span class="token operator">+</span> <span class="token keyword">http</span><span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>m<span class="token punctuation">.</span>baidu<span class="token punctuation">.</span>com<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/shimingw/vpblog/edit/master/docs/服务器搭建/02.nginx.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">更新于:</span> <span class="time">2020-4-1 5:24:26 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/docs/2020-02-07-服务器搭建-SSL的申请与部署/" class="prev">
        SSL的申请与部署
      </a></span> <span class="next"><a href="/docs/2018-03-25-服务器搭建-Linux/">
        Linux
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><div class="pace  pace-inactive" style="display:none;" data-v-57a75e74><div data-progress-text="100%" data-progress="99" class="pace-progress" style="transform:translate3d(0%, 0px, 0px);" data-v-57a75e74><div class="pace-progress-inner" data-v-57a75e74></div></div></div><div class="my-popup" style="display:none;" data-v-3414bdeb><div class="my-popup-container" data-v-3414bdeb><div class="my-popup-exit" data-v-3414bdeb></div> <img src="" alt data-v-3414bdeb></div></div><!----><!----><div></div></div></div>
    <script src="/assets/js/app.9c824518.js" defer></script><script src="/assets/js/2.8423ab85.js" defer></script><script src="/assets/js/52.95df1785.js" defer></script><script src="/assets/js/5.d4f27e5e.js" defer></script>
  </body>
</html>
